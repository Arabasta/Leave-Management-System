<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leave Application</title>
    <script src="/js/leaveForm.js"></script>
</head>
<body>
<div th:replace="fragments/navbar :: menu"></div>
<h3>Leave Application Details</h3>

<script>
    function validateForm() {
        const leaveStatus = document.querySelector('input[name="leaveStatus"]:checked').value;
        const rejectionReason = document.getElementById('rejectionReason').value;

        if (leaveStatus === 'REJECTED' && rejectionReason.trim() === '') {
            alert("Please provide a reason for rejection.");
            return false;
        }
        return true;
    }
</script>

<form th:object="${leave}" method="post" th:action="@{/submitLeaveApplication}">
    <table>
        <tbody>
        <tr>
            <td>Employee Name</td>
            <td th:text="${leave.submittingEmployee.name}"></td>
        </tr>
        <tr>
            <td>Leave Type</td>
            <td th:text="${leave.leaveType}"></td>
        </tr>
        <tr>
            <td>Start Date</td>
            <td th:text="${leave.startDate}"></td>
        </tr>
        <tr>
            <td>End Date</td>
            <td th:text="${leave.endDate}"></td>
        </tr>
        <tr>
            <td>Approving Manager</td>
            <td th:text="${leave.submittingEmployee.manager.name}"></td>
        </tr>
        <tr>
            <td>Reason</td>
            <td th:text="${leave.submissionReason}"></td>
        </tr>
        <tr>
            <td>Work Dissemination (if any)</td>
            <td th:text="${leave.workDissemination}"></td>
        </tr>
        <tr>
            <td>Contact Details (if on an overseas trip)</td>
            <td th:text="${leave.contactDetails}"></td>
        </tr>
        <tr>
            <td>Leave Status</td>
            <td th:text="${leave.leaveStatus}"></td>
        </tr>
        <tr>
            <td>Approval Status</td>
            <td>
                <!-- Approve or Reject Buttons here -->
                <fieldset>
                    <label for="approve">Approve</label>
                    <input type="radio" id="approve" name="leaveStatus" value="APPROVED" th:field="*{leaveStatus}" />
                    &nbsp;&nbsp;
                    <label for="reject">Reject</label>
                    <input type="radio" id="reject" name="leaveStatus" value="REJECTED" th:field="*{leaveStatus}" />
                </fieldset>
            </td>
            <td th:if="${#fields.hasErrors('leaveStatus')}" th:errors="*{leaveStatus}"></td>
        </tr>
        <tr>
            <td>
                <label for="rejectionReason">Rejection Reason</label>
            </td>
            <td>
                <textarea id="rejectionReason" rows="2" cols="50" th:field="*{rejectionReason}"></textarea>
            </td>
            <td th:if="${#fields.hasErrors('rejectionReason')}" th:errors="*{rejectionReason}"></td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" value="Submit" />
                <input type="reset" value="Reset" />
            </td>
        </tr>
        <tr>
            <td>
                <a href="#" onclick="history.go(-1); return false;">Back</a>
            </td>
        </tr>
        </tbody>
    </table>
</form>
</body>
</html>