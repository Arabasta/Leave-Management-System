<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" lang="en">

<head th:replace="fragments/head :: html_head">
    <title>Subordinate Leave History</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
<div th:replace="fragments/navbar :: menu"></div>

<br/>
<h2 class="text-center">Subordinate Leave History</h2>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Search Parameter - Name or Id -->
            <form action="#" th:action="@{/manager/leave/managerView}" method="post">
                <div class="form-group">
                    <label for="searchType"><strong>Search By:</strong></label>
                    <select id="searchType" name="searchType" class="form-select" th:value="${reportingDTO.searchType}">
                        <option th:if="${reportingDTO.searchType==null or reportingDTO.searchType=='name'}" value="name">Name</option>
                        <option th:if="${reportingDTO.searchType==null or reportingDTO.searchType=='name'}" value="id">Employee Id</option>
                        <option th:if="${reportingDTO.searchType=='id'}" value="id">Employee Id</option>
                        <option th:if="${reportingDTO.searchType=='id'}" value="name">Name</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><strong>Enter keyword:</strong>
                    <input th:if="${reportingDTO.keyword==null}" type="text" name="keyword" class="form-control"/>
                    <input th:unless="${reportingDTO.keyword==null}" th:value="${reportingDTO.keyword}" type="text" name="keyword" class="form-control"/>
                    </label>
                </div>
                <!-- Search Parameter - Date Range -->
                <div class="form-group">
                    <label><strong>Date Range:</strong></label>
                    <div class="input-group">
                        <input th:if="${reportingDTO.startDate==null}" class="form-control" type="date" name="startDate">
                        <input th:unless="${reportingDTO.startDate==null}" th:value="${reportingDTO.startDate}" class="form-control" type="date" name="startDate">
                        <div class="input-group-text">To</div>
                        <input th:if="${reportingDTO.endDate==null}" class="form-control" type="date" name="endDate">
                        <input th:unless="${reportingDTO.endDate==null}" th:value="${reportingDTO.endDate}" class="form-control" type="date" name="endDate">
                    </div>
                </div>
                <!-- Search Parameter - Status -->
                <div class="form-group">
                    <label for="applicationStatus"><strong>Leave Status:</strong></label>
                    <select class="form-select" name="leaveStatus" id="applicationStatus">
                        <option th:if="${reportingDTO.leaveStatus=='ALL'}" th:value="'ALL'" th:text="'ALL'" selected></option>
                        <option th:unless="${reportingDTO.leaveStatus=='ALL'}" selected th:text="'Selection: '+${reportingDTO.leaveStatus}" th:value="${T(com.team4.leaveprocessingsystem.model.enums.LeaveStatusEnum).valueOf(reportingDTO.leaveStatus)}"></option>
                        <option th:unless="${reportingDTO.leaveStatus=='ALL'}" th:value="'ALL'" th:text="'ALL'"></option>
                        <option th:each="status : ${T(com.team4.leaveprocessingsystem.model.enums.LeaveStatusEnum).values()}"
                                th:value="${status}" th:text="${status}"></option>
                    </select>
                </div>
                <br>
                <!-- Search Button -->
                <div class="form-group text-center">
                    <button type="submit" class="btn btn-primary">Search</button>
                    <a class="btn btn-secondary" th:href="@{/manager/leave/managerView}">Reset</a>
                </div>
            </form>
            <!-- Save as CSV Button -->
            <form class="text-center mt-3" method="POST" th:object="${reportingDTO}" th:action="@{/manager/reporting/downloadEmployeeLeaveApplicationsCSV}">
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save as CSV</button>
                    <input type="hidden" th:field="${reportingDTO.applications}">
                    <input type="hidden" th:field="${reportingDTO.managerId}">
                    <input type="hidden" th:field="${reportingDTO.keyword}">
                    <input type="hidden" th:field="${reportingDTO.searchType}">
                    <input type="hidden" th:field="${reportingDTO.startDate}">
                    <input type="hidden" th:field="${reportingDTO.endDate}">
                    <input type="hidden" th:field="${reportingDTO.leaveStatus}">
                </div>
            </form>
        </div>
    </div>
    <div class="row justify-content-center mt-4">
        <div class="col-md-10">
            <table th:if="${not #lists.isEmpty(reportingDTO.applications)}" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>Application ID</th>
                    <th>Employee ID</th>
                    <th>Name</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Leave Status</th>
                    <th>Leave Type</th>
                    <th>Details</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="leaveApplication : ${reportingDTO.applications}">
                    <td th:text="${leaveApplication.getId()}">Application Id</td>
                    <td th:text="${leaveApplication.getSubmittingEmployee().id}">Employee id</td>
                    <td th:text="${leaveApplication.getSubmittingEmployee().getName()}">Name</td>
                    <td th:text="${#temporals.format(leaveApplication.getStartDate(), 'dd-MMM-yyyy')}">Start Date</td>
                    <td th:text="${#temporals.format(leaveApplication.getEndDate(), 'dd-MMM-yyyy')}">End Date</td>
                    <td th:text="${leaveApplication.getLeaveStatus()}">Leave Status</td>
                    <td th:text="${leaveApplication.leaveType}">Leave Type</td>
                    <td><a th:href="@{/manager/leave/viewSubordinateDetails/{id}(id=${leaveApplication.getId()})}">Details</a></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<br>
<input type="hidden" name="keyword" th:value="${reportingDTO.keyword}"/>
<input type="hidden" name="searchType" th:value="${reportingDTO.searchType}"/>
<input type="hidden" name="startDate" th:value="${reportingDTO.startDate}"/>
<input type="hidden" name="endDate" th:value="${reportingDTO.endDate}"/>
<input type="hidden" name="leaveStatus" th:value="${reportingDTO.leaveStatus}"/>
<div th:if="${page.totalPages > 1}">
    <nav aria-label="Pagination">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${page.number == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/manager/leave/managerView(keyword=${reportingDTO.keyword}, searchType=${reportingDTO.searchType},
                 startDate=${reportingDTO.startDate}, endDate=${reportingDTO.endDate}, leaveStatus=${reportingDTO.leaveStatus}, pageNo=${page.number - 1},
                  pageSize=${page.size})}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item active">
                <a class="page-link" th:text="${page.number + 1}"></a>
            </li>
            <li class="page-item" th:classappend="${page.number + 1 == page.totalPages} ? 'disabled'">
                <a class="page-link" th:href="@{/manager/leave/managerView(keyword=${reportingDTO.keyword}, searchType=${reportingDTO.searchType},
                 startDate=${reportingDTO.startDate}, endDate=${reportingDTO.endDate}, leaveStatus=${reportingDTO.leaveStatus}, pageNo=${page.number + 1},
                  pageSize=${page.size})}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>
<div style="text-align: center; margin-top: 20px;">
    <form th:action="@{/manager/leave/managerView}" method="get">
        <label for="pageSize">Results per page:</label>
        <select id="pageSize" name="pageSize" onchange="this.form.submit()">
            <option th:value="10" th:text="10" th:selected="${page.size == 10}"></option>
            <option th:value="20" th:text="20" th:selected="${page.size == 20}"></option>
            <option th:value="25" th:text="25" th:selected="${page.size == 25}"></option>
        </select>
        <input type="hidden" name="keyword" th:value="${reportingDTO.keyword}"/>
        <input type="hidden" name="searchType" th:value="${reportingDTO.searchType}"/>
        <input type="hidden" name="startDate" th:value="${reportingDTO.startDate}"/>
        <input type="hidden" name="endDate" th:value="${reportingDTO.endDate}"/>
        <input type="hidden" name="leaveStatus" th:value="${reportingDTO.leaveStatus}"/>
    </form>
</div>
<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2ABjtSj7R8gFqjwkJXYa2yMwD4/Op3ZSffvENxyl5P4wKxqlpF4F2N3y9p" crossorigin="anonymous"></script>
</body>

</html>
